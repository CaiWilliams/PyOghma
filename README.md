# PyOghma

PyOghma is a Python API designed to interface with OghmaNano, a powerful tool for drift-diffusion simulations. It provides a programmatic way to configure, execute, and analyze simulations, enabling researchers and engineers to streamline their workflows and automate complex tasks. With PyOghma, you can easily modify optical, thermal, epitaxy, and simulation parameters, run simulations, and analyze resultsâ€”all within Python.

## Features

- Programmatically modify and execute drift-diffusion simulations.
- Seamlessly integrate with OghmaNano for advanced simulation workflows.
- Support for optical, thermal, epitaxy, and simulation configurations.
- Easy-to-use Python interface for managing and analyzing simulation results.

## Installation

Before installing PyOghma, ensure that OghmaNano is installed. You can download OghmaNano from [oghma-nano.com](https://www.oghma-nano.com).

To install PyOghma, use pip:

```bash
python -m pip install PyOghma
```

## Documentation

For detailed documentation, visit the [PyOghma Documentation](https://caiwilliams.github.io/PyOghma/index.html).

## Usage/Examples

To use PyOghma, you need a source simulation generated by OghmaNano. Extract the `sim.json` file from the simulation directory. Once extracted, you can programmatically modify and execute the simulation using PyOghma, as shown in the example below:

```python
# filepath: /media/cai/Big/PycharmProjects/PyOghma/Test.py
import PyOghma as po
import matplotlib.pyplot as plt
import mgzip as mg
import shutil
import ujson as json
import numpy as np
import os

# Initialize OghmaNano and Results
Oghma = po.OghmaNano()
Results = po.Results()

# Set source simulation and experiment name
source_simulation = os.path.join(os.getcwd(), "p3htpcbm")
Oghma.set_source_simulation(source_simulation)
experiment_name = 'NewExperiment'
Oghma.set_experiment_name(experiment_name)

# Define parameters
mobility = 1e-5
trap_density = 1e-18
trapping_crosssection = 1e-20
recombination_crosssection = 1e-20
urbach_energy = 40e-3
temperature = 300
intensity = list(np.logspace(np.log10(1e-2), np.log10(1e1), 500))

# Set variables and clone simulations
Oghma.set_variables(iter_used='product', intensity=intensity)
for idx, param in enumerate(Oghma.product):
    experiment_dir = Oghma.hashes[idx]
    Oghma.clone(experiment_dir)

    # Update optical configurations
    Oghma.Optical.LightSources.set_light_Intensity(param[0])
    am15 = po.Optical.LightSource()
    Oghma.Optical.LightSources.add_light_source(am15)
    Oghma.Optical.LightSources.update()

    # Update thermal configurations
    Oghma.Thermal.set_temperature(temperature)
    Oghma.Thermal.update()

    # Update epitaxy configurations
    Oghma.Epitaxy.load_existing()
    Oghma.Epitaxy.pm6y6.dos.mobility('both', mobility)
    Oghma.Epitaxy.pm6y6.dos.trap_density('both', trap_density)
    Oghma.Epitaxy.pm6y6.dos.trapping_rate('both', 'free to trap', trapping_crosssection)
    Oghma.Epitaxy.pm6y6.dos.trapping_rate('both', 'trap to free', recombination_crosssection)
    Oghma.Epitaxy.pm6y6.dos.urbach_energy('both', urbach_energy)
    Oghma.Epitaxy.update()

    # Add job
    Oghma.add_job(experiment_dir)

# Run jobs and save results
Oghma.run_jobs()
Results.load_experiment(Oghma)
Results.create_dict()
Results.save_dict()

# Load experiment data
exp_dir = os.path.join(os.getcwd(), experiment_name + '.exp')
with mg.open(exp_dir, 'r') as f:
    data = json.load(f)

# Calculate transport resistance and plot results
TR = po.Calculate.Transport_Resistance(exp_dir)
TR.calculate()
plt.plot(intensity, TR.TR_Voc)

# Clean up and display plot
shutil.rmtree(Oghma.results_dir)
plt.show()
```

## API Overview

### Core Classes

- **`OghmaNano`**: Main class to manage simulations and configurations.
- **`Results`**: Class to handle and analyze simulation results.
- **`Optical`**: Class to configure optical properties such as light intensity and spectra.
- **`Thermal`**: Class to configure thermal properties like temperature and mesh.
- **`Epitaxy`**: Class to configure epitaxy properties such as mobility, trap density, and Urbach energy.

### Key Methods

#### `OghmaNano`
- `set_source_simulation(source_simulation)`: Set the source simulation directory.
- `set_experiment_name(experiment_name)`: Set the name of the experiment.
- `clone(dest_dir)`: Clone the source simulation to a new directory.
- `add_job(job_name)`: Add a simulation job.
- `run_jobs()`: Execute all added jobs.

#### `Results`
- `load_experiment(Oghma)`: Load the experiment details.
- `find_results()`: Locate and analyze simulation results.

#### `Optical`
- `set_light_Intensity(intensity)`: Set the light intensity in suns.
- `update()`: Update the optical configuration.

#### `Thermal`
- `set_temperature(temperature)`: Set the simulation temperature.
- `update()`: Update the thermal configuration.

#### `Epitaxy`
- `load_existing()`: Load existing epitaxy configurations.
- `update()`: Update the epitaxy configuration.
- `dos.mobility(carrier, value)`: Set carrier mobility.
- `dos.trap_density(carrier, value)`: Set trap density.
- `dos.trapping_rate(carrier, direction, value)`: Set trapping rates.
- `dos.urbach_energy(carrier, value)`: Set Urbach energy.

## Contributing

Contributions are welcome! If you'd like to contribute to PyOghma, please fork the repository and submit a pull request.

## License

This project is licensed under the MIT License. See the LICENSE file for details.

## Authors

- [@CaiWilliams](https://www.github.com/CaiWilliams)
